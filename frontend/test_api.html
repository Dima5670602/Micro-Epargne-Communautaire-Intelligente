<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test API</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <h2> Test de l'API</h2>
    <button class="btn btn-primary" onclick="testCreateCorridor()">Tester Cr√©ation Corridor</button>
    <pre id="result" class="mt-3 p-3 bg-light"></pre>
  </div>

  <script src="/assets/js/auth.js"></script>
  <script>
    async function testCreateCorridor() {
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = 'Test en cours...\n\n';
      
      try {
        const token = auth.getToken();
        if (!token) {
          resultDiv.textContent += ' Pas de token - connectez-vous d\'abord\n';
          return;
        }
        
        resultDiv.textContent += ` Token trouv√©: ${token.substring(0, 20)}...\n\n`;
        
        const testData = {
          name: "Test Corridor " + Date.now(),
          bareme: 50000,
          commission: 500,
          phone: "+226 70 12 34 56"
        };
        
        resultDiv.textContent += `üì§ Donn√©es envoy√©es:\n${JSON.stringify(testData, null, 2)}\n\n`;
        
        const response = await fetch('/api/corridors/create', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify(testData)
        });
        
        resultDiv.textContent += ` Statut: ${response.status} ${response.statusText}\n\n`;
        
        const result = await response.json();
        resultDiv.textContent += ` R√©ponse:\n${JSON.stringify(result, null, 2)}\n`;
        
      } catch (error) {
        resultDiv.textContent += `\n ERREUR:\n${error.message}\n\n${error.stack}`;
      }
    }
  </script>
</body>
</html>